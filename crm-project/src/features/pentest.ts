import { createSlice, PayloadAction } from "@reduxjs/toolkit";
import { ClientAssessment, Finding, POC, URL, URLType } from "../types/pentest";

interface PentestState {
  rowperpage: number;
  currentpage: number;
  isEditing: boolean;

  client_assessment_id: ClientAssessment | null;

  urls: URLType;
  url: URL | null;

  finding?: Finding | null;

  pocs?: POC[];
}

const initialState: PentestState = {
  rowperpage: 10,
  currentpage: 1,
  isEditing: false,
  client_assessment_id: null,
  urls: {
    count: 0,
    next: null,
    previous: null,
    results: [],
  },
  url: null,
  finding: null,
  pocs: []
};

const pentestSlice = createSlice({
  name: "pentest",
  initialState,
  reducers: {
    setClientAssessmentTypeId: (state, action: PayloadAction<ClientAssessment>) => {
      state.client_assessment_id = action.payload;
    },

    setRowsPerPage: (state, action: PayloadAction<number>) => {
      state.rowperpage = action.payload;
    },

    setCurrentPage: (state, action: PayloadAction<number>) => {
      state.currentpage = action.payload;
    },

    toggleEditing: (state) => {
      state.isEditing = !state.isEditing;
    },

    setURLs: (state, action: PayloadAction<URLType>) => {
      state.urls = action.payload;
    },

    setURL: (state, action: PayloadAction<URL>) => {
      state.url = action.payload;
    },

    setFinding: (state, action: PayloadAction<Finding>) => {
      state.finding = action.payload
    },

    setPOCs: (state, action: PayloadAction<POC>) =>{
      state.pocs?.push(action.payload)
    },

    removePOC: (state, action: PayloadAction<number>) => {
      const updatePOC = state.pocs?.filter((poc) => poc.steps !== action.payload);

      // update the steps in sequences 
      state.pocs = updatePOC?.map((poc, index) => ({
        ...poc,
        steps : index+1
      }))
    },
  },
});

export const {
  setRowsPerPage,
  setCurrentPage,
  toggleEditing,
  setClientAssessmentTypeId,
  setURL,
  setURLs,
  setFinding,
  setPOCs,
  removePOC,
} = pentestSlice.actions;
export default pentestSlice.reducer;
